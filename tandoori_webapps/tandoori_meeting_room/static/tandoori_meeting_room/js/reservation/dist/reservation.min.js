/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

//     (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/**
 * @license RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*
 * RequireJS underscore-tpl
 * Loads and precompile underscore templates
 * https://github.com/dciccale/requirejs-underscore-tpl
 *
 * Dependencies:
 * Underscore.js: https://underscorejs.org
 * RequireJS text plugin: https://github.com/requirejs/text
 *
 * Copyright (c) 2013 Denis Ciccale (@tdecs)
 * Licensed under the MIT license.
 * https://github.com/dciccale/requirejs-underscore-tpl/blob/master/LICENSE-MIT
 */

(function(){var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.slice(0,v.length-1).concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){var i=l.call(arguments,0);return typeof i[0]!="string"&&i.length===1&&i.push(null),n.apply(e,i.concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("../../../../../tandoori_library/bower_components/almond/almond.js",function(){}),function(){function x(e){function t(t,n,r,i,s,o){for(;s>=0&&s<o;s+=e){var u=i?i[s]:s;r=n(r,t[u],u,t)}return r}return function(n,r,i,s){r=v(r,s,4);var o=!S(n)&&d.keys(n),u=(o||n).length,a=e>0?0:u-1;return arguments.length<3&&(i=n[o?o[a]:a],a+=e),t(n,r,i,o,a,u)}}function C(e){return function(t,n,r){n=m(n,r);var i=E(t),s=e>0?0:i-1;for(;s>=0&&s<i;s+=e)if(n(t[s],s,t))return s;return-1}}function k(e,t,n){return function(r,i,s){var u=0,a=E(r);if(typeof s=="number")e>0?u=s>=0?s:Math.max(s+a,u):a=s>=0?Math.min(s+1,a):s+a+1;else if(n&&s&&a)return s=n(r,i),r[s]===i?s:-1;if(i!==i)return s=t(o.call(r,u,a),d.isNaN),s>=0?s+u:-1;for(s=e>0?u:a-1;s>=0&&s<a;s+=e)if(r[s]===i)return s;return-1}}function M(e,t){var n=O.length,i=e.constructor,s=d.isFunction(i)&&i.prototype||r,o="constructor";d.has(e,o)&&!d.contains(t,o)&&t.push(o);while(n--)o=O[n],o in e&&e[o]!==s[o]&&!d.contains(t,o)&&t.push(o)}var e=this,t=e._,n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.push,o=n.slice,u=r.toString,a=r.hasOwnProperty,f=Array.isArray,l=Object.keys,c=i.bind,h=Object.create,p=function(){},d=function(e){if(e instanceof d)return e;if(!(this instanceof d))return new d(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=d),exports._=d):e._=d,d.VERSION="1.8.3";var v=function(e,t,n){if(t===void 0)return e;switch(n==null?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}},m=function(e,t,n){return e==null?d.identity:d.isFunction(e)?v(e,t,n):d.isObject(e)?d.matcher(e):d.property(e)};d.iteratee=function(e,t){return m(e,t,Infinity)};var g=function(e,t){return function(n){var r=arguments.length;if(r<2||n==null)return n;for(var i=1;i<r;i++){var s=arguments[i],o=e(s),u=o.length;for(var a=0;a<u;a++){var f=o[a];if(!t||n[f]===void 0)n[f]=s[f]}}return n}},y=function(e){if(!d.isObject(e))return{};if(h)return h(e);p.prototype=e;var t=new p;return p.prototype=null,t},b=function(e){return function(t){return t==null?void 0:t[e]}},w=Math.pow(2,53)-1,E=b("length"),S=function(e){var t=E(e);return typeof t=="number"&&t>=0&&t<=w};d.each=d.forEach=function(e,t,n){t=v(t,n);var r,i;if(S(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var s=d.keys(e);for(r=0,i=s.length;r<i;r++)t(e[s[r]],s[r],e)}return e},d.map=d.collect=function(e,t,n){t=m(t,n);var r=!S(e)&&d.keys(e),i=(r||e).length,s=Array(i);for(var o=0;o<i;o++){var u=r?r[o]:o;s[o]=t(e[u],u,e)}return s},d.reduce=d.foldl=d.inject=x(1),d.reduceRight=d.foldr=x(-1),d.find=d.detect=function(e,t,n){var r;S(e)?r=d.findIndex(e,t,n):r=d.findKey(e,t,n);if(r!==void 0&&r!==-1)return e[r]},d.filter=d.select=function(e,t,n){var r=[];return t=m(t,n),d.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r},d.reject=function(e,t,n){return d.filter(e,d.negate(m(t)),n)},d.every=d.all=function(e,t,n){t=m(t,n);var r=!S(e)&&d.keys(e),i=(r||e).length;for(var s=0;s<i;s++){var o=r?r[s]:s;if(!t(e[o],o,e))return!1}return!0},d.some=d.any=function(e,t,n){t=m(t,n);var r=!S(e)&&d.keys(e),i=(r||e).length;for(var s=0;s<i;s++){var o=r?r[s]:s;if(t(e[o],o,e))return!0}return!1},d.contains=d.includes=d.include=function(e,t,n,r){S(e)||(e=d.values(e));if(typeof n!="number"||r)n=0;return d.indexOf(e,t,n)>=0},d.invoke=function(e,t){var n=o.call(arguments,2),r=d.isFunction(t);return d.map(e,function(e){var i=r?t:e[t];return i==null?i:i.apply(e,n)})},d.pluck=function(e,t){return d.map(e,d.property(t))},d.where=function(e,t){return d.filter(e,d.matcher(t))},d.findWhere=function(e,t){return d.find(e,d.matcher(t))},d.max=function(e,t,n){var r=-Infinity,i=-Infinity,s,o;if(t==null&&e!=null){e=S(e)?e:d.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s>r&&(r=s)}else t=m(t,n),d.each(e,function(e,n,s){o=t(e,n,s);if(o>i||o===-Infinity&&r===-Infinity)r=e,i=o});return r},d.min=function(e,t,n){var r=Infinity,i=Infinity,s,o;if(t==null&&e!=null){e=S(e)?e:d.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s<r&&(r=s)}else t=m(t,n),d.each(e,function(e,n,s){o=t(e,n,s);if(o<i||o===Infinity&&r===Infinity)r=e,i=o});return r},d.shuffle=function(e){var t=S(e)?e:d.values(e),n=t.length,r=Array(n);for(var i=0,s;i<n;i++)s=d.random(0,i),s!==i&&(r[i]=r[s]),r[s]=t[i];return r},d.sample=function(e,t,n){return t==null||n?(S(e)||(e=d.values(e)),e[d.random(e.length-1)]):d.shuffle(e).slice(0,Math.max(0,t))},d.sortBy=function(e,t,n){return t=m(t,n),d.pluck(d.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var T=function(e){return function(t,n,r){var i={};return n=m(n,r),d.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};d.groupBy=T(function(e,t,n){d.has(e,n)?e[n].push(t):e[n]=[t]}),d.indexBy=T(function(e,t,n){e[n]=t}),d.countBy=T(function(e,t,n){d.has(e,n)?e[n]++:e[n]=1}),d.toArray=function(e){return e?d.isArray(e)?o.call(e):S(e)?d.map(e,d.identity):d.values(e):[]},d.size=function(e){return e==null?0:S(e)?e.length:d.keys(e).length},d.partition=function(e,t,n){t=m(t,n);var r=[],i=[];return d.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},d.first=d.head=d.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:d.initial(e,e.length-t)},d.initial=function(e,t,n){return o.call(e,0,Math.max(0,e.length-(t==null||n?1:t)))},d.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:d.rest(e,Math.max(0,e.length-t))},d.rest=d.tail=d.drop=function(e,t,n){return o.call(e,t==null||n?1:t)},d.compact=function(e){return d.filter(e,d.identity)};var N=function(e,t,n,r){var i=[],s=0;for(var o=r||0,u=E(e);o<u;o++){var a=e[o];if(S(a)&&(d.isArray(a)||d.isArguments(a))){t||(a=N(a,t,n));var f=0,l=a.length;i.length+=l;while(f<l)i[s++]=a[f++]}else n||(i[s++]=a)}return i};d.flatten=function(e,t){return N(e,t,!1)},d.without=function(e){return d.difference(e,o.call(arguments,1))},d.uniq=d.unique=function(e,t,n,r){d.isBoolean(t)||(r=n,n=t,t=!1),n!=null&&(n=m(n,r));var i=[],s=[];for(var o=0,u=E(e);o<u;o++){var a=e[o],f=n?n(a,o,e):a;t?((!o||s!==f)&&i.push(a),s=f):n?d.contains(s,f)||(s.push(f),i.push(a)):d.contains(i,a)||i.push(a)}return i},d.union=function(){return d.uniq(N(arguments,!0,!0))},d.intersection=function(e){var t=[],n=arguments.length;for(var r=0,i=E(e);r<i;r++){var s=e[r];if(d.contains(t,s))continue;for(var o=1;o<n;o++)if(!d.contains(arguments[o],s))break;o===n&&t.push(s)}return t},d.difference=function(e){var t=N(arguments,!0,!0,1);return d.filter(e,function(e){return!d.contains(t,e)})},d.zip=function(){return d.unzip(arguments)},d.unzip=function(e){var t=e&&d.max(e,E).length||0,n=Array(t);for(var r=0;r<t;r++)n[r]=d.pluck(e,r);return n},d.object=function(e,t){var n={};for(var r=0,i=E(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},d.findIndex=C(1),d.findLastIndex=C(-1),d.sortedIndex=function(e,t,n,r){n=m(n,r,1);var i=n(t),s=0,o=E(e);while(s<o){var u=Math.floor((s+o)/2);n(e[u])<i?s=u+1:o=u}return s},d.indexOf=k(1,d.findIndex,d.sortedIndex),d.lastIndexOf=k(-1,d.findLastIndex),d.range=function(e,t,n){t==null&&(t=e||0,e=0),n=n||1;var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r);for(var s=0;s<r;s++,e+=n)i[s]=e;return i};var L=function(e,t,n,r,i){if(r instanceof t){var s=y(e.prototype),o=e.apply(s,i);return d.isObject(o)?o:s}return e.apply(n,i)};d.bind=function(e,t){if(c&&e.bind===c)return c.apply(e,o.call(arguments,1));if(!d.isFunction(e))throw new TypeError("Bind must be called on a function");var n=o.call(arguments,2),r=function(){return L(e,r,t,this,n.concat(o.call(arguments)))};return r},d.partial=function(e){var t=o.call(arguments,1),n=function(){var r=0,i=t.length,s=Array(i);for(var o=0;o<i;o++)s[o]=t[o]===d?arguments[r++]:t[o];while(r<arguments.length)s.push(arguments[r++]);return L(e,n,this,this,s)};return n},d.bindAll=function(e){var t,n=arguments.length,r;if(n<=1)throw new Error("bindAll must be passed function names");for(t=1;t<n;t++)r=arguments[t],e[r]=d.bind(e[r],e);return e},d.memoize=function(e,t){var n=function(r){var i=n.cache,s=""+(t?t.apply(this,arguments):r);return d.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},d.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},d.defer=d.partial(d.delay,d,1),d.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:d.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=d.now();!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0||l>t?(o&&(clearTimeout(o),o=null),u=f,s=e.apply(r,i),o||(r=i=null)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},d.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=d.now()-o;f<t&&f>=0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=d.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},d.wrap=function(e,t){return d.partial(t,e)},d.negate=function(e){return function(){return!e.apply(this,arguments)}},d.compose=function(){var e=arguments,t=e.length-1;return function(){var n=t,r=e[t].apply(this,arguments);while(n--)r=e[n].call(this,r);return r}},d.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},d.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},d.once=d.partial(d.before,2);var A=!{toString:null}.propertyIsEnumerable("toString"),O=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];d.keys=function(e){if(!d.isObject(e))return[];if(l)return l(e);var t=[];for(var n in e)d.has(e,n)&&t.push(n);return A&&M(e,t),t},d.allKeys=function(e){if(!d.isObject(e))return[];var t=[];for(var n in e)t.push(n);return A&&M(e,t),t},d.values=function(e){var t=d.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},d.mapObject=function(e,t,n){t=m(t,n);var r=d.keys(e),i=r.length,s={},o;for(var u=0;u<i;u++)o=r[u],s[o]=t(e[o],o,e);return s},d.pairs=function(e){var t=d.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},d.invert=function(e){var t={},n=d.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},d.functions=d.methods=function(e){var t=[];for(var n in e)d.isFunction(e[n])&&t.push(n);return t.sort()},d.extend=g(d.allKeys),d.extendOwn=d.assign=g(d.keys),d.findKey=function(e,t,n){t=m(t,n);var r=d.keys(e),i;for(var s=0,o=r.length;s<o;s++){i=r[s];if(t(e[i],i,e))return i}},d.pick=function(e,t,n){var r={},i=e,s,o;if(i==null)return r;d.isFunction(t)?(o=d.allKeys(i),s=v(t,n)):(o=N(arguments,!1,!1,1),s=function(e,t,n){return t in n},i=Object(i));for(var u=0,a=o.length;u<a;u++){var f=o[u],l=i[f];s(l,f,i)&&(r[f]=l)}return r},d.omit=function(e,t,n){if(d.isFunction(t))t=d.negate(t);else{var r=d.map(N(arguments,!1,!1,1),String);t=function(e,t){return!d.contains(r,t)}}return d.pick(e,t,n)},d.defaults=g(d.allKeys,!0),d.create=function(e,t){var n=y(e);return t&&d.extendOwn(n,t),n},d.clone=function(e){return d.isObject(e)?d.isArray(e)?e.slice():d.extend({},e):e},d.tap=function(e,t){return t(e),e},d.isMatch=function(e,t){var n=d.keys(t),r=n.length;if(e==null)return!r;var i=Object(e);for(var s=0;s<r;s++){var o=n[s];if(t[o]!==i[o]||!(o in i))return!1}return!0};var _=function(e,t,n,r){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return e===t;e instanceof d&&(e=e._wrapped),t instanceof d&&(t=t._wrapped);var i=u.call(e);if(i!==u.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":if(+e!==+e)return+t!==+t;return+e===0?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var s=i==="[object Array]";if(!s){if(typeof e!="object"||typeof t!="object")return!1;var o=e.constructor,a=t.constructor;if(o!==a&&!(d.isFunction(o)&&o instanceof o&&d.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];var f=n.length;while(f--)if(n[f]===e)return r[f]===t;n.push(e),r.push(t);if(s){f=e.length;if(f!==t.length)return!1;while(f--)if(!_(e[f],t[f],n,r))return!1}else{var l=d.keys(e),c;f=l.length;if(d.keys(t).length!==f)return!1;while(f--){c=l[f];if(!d.has(t,c)||!_(e[c],t[c],n,r))return!1}}return n.pop(),r.pop(),!0};d.isEqual=function(e,t){return _(e,t)},d.isEmpty=function(e){return e==null?!0:S(e)&&(d.isArray(e)||d.isString(e)||d.isArguments(e))?e.length===0:d.keys(e).length===0},d.isElement=function(e){return!!e&&e.nodeType===1},d.isArray=f||function(e){return u.call(e)==="[object Array]"},d.isObject=function(e){var t=typeof e;return t==="function"||t==="object"&&!!e},d.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){d["is"+e]=function(t){return u.call(t)==="[object "+e+"]"}}),d.isArguments(arguments)||(d.isArguments=function(e){return d.has(e,"callee")}),typeof /./!="function"&&typeof Int8Array!="object"&&(d.isFunction=function(e){return typeof e=="function"||!1}),d.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},d.isNaN=function(e){return d.isNumber(e)&&e!==+e},d.isBoolean=function(e){return e===!0||e===!1||u.call(e)==="[object Boolean]"},d.isNull=function(e){return e===null},d.isUndefined=function(e){return e===void 0},d.has=function(e,t){return e!=null&&a.call(e,t)},d.noConflict=function(){return e._=t,this},d.identity=function(e){return e},d.constant=function(e){return function(){return e}},d.noop=function(){},d.property=b,d.propertyOf=function(e){return e==null?function(){}:function(t){return e[t]}},d.matcher=d.matches=function(e){return e=d.extendOwn({},e),function(t){return d.isMatch(t,e)}},d.times=function(e,t,n){var r=Array(Math.max(0,e));t=v(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},d.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},d.now=Date.now||function(){return(new Date).getTime()};var D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},P=d.invert(D),H=function(e){var t=function(t){return e[t]},n="(?:"+d.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=e==null?"":""+e,r.test(e)?e.replace(i,t):e}};d.escape=H(D),d.unescape=H(P),d.result=function(e,t,n){var r=e==null?void 0:e[t];return r===void 0&&(r=n),d.isFunction(r)?r.call(e):r};var B=0;d.uniqueId=function(e){var t=++B+"";return e?e+t:t},d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var j=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\u2028|\u2029/g,q=function(e){return"\\"+F[e]};d.template=function(e,t,n){!t&&n&&(t=n),t=d.defaults({},t,d.templateSettings);var r=RegExp([(t.escape||j).source,(t.interpolate||j).source,(t.evaluate||j).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(I,q),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,d)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},d.chain=function(e){var t=d(e);return t._chain=!0,t};var R=function(e,t){return e._chain?d(t).chain():t};d.mixin=function(e){d.each(d.functions(e),function(t){var n=d[t]=e[t];d.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),R(this,n.apply(d,e))}})},d.mixin(d),d.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];d.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e==="shift"||e==="splice")&&n.length===0&&delete n[0],R(this,n)}}),d.each(["concat","join","slice"],function(e){var t=n[e];d.prototype[e]=function(){return R(this,t.apply(this._wrapped,arguments))}}),d.prototype.value=function(){return this._wrapped},d.prototype.valueOf=d.prototype.toJSON=d.prototype.value,d.prototype.toString=function(){return""+this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return d})}.call(this),define("jquery",[],function(){return jQuery}),function(e,t){if(typeof define=="function"&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)});else if(typeof exports!="undefined"){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="1.1.2",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events=void 0,this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r)for(l=0,h=o.length;l<h;l++)s=o[l],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&h(n,t),r&&h(r,arguments),this},stopListening:function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=!t&&!r;!r&&typeof t=="object"&&(r=this),e&&((i={})[e._listenId]=e);for(var o in i)e=i[o],e.off(t,r,this),(s||n.isEmpty(e._events))&&delete this._listeningTo[o];return this}},l=/\s+/,c=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeningTo||(this._listeningTo={}),o=t._listenId||(t._listenId=n.uniqueId("l"));return s[o]=t,!i&&typeof r=="object"&&(i=this),t[e](r,i,this),this}}),f.bind=f.on,f.unbind=f.off,n.extend(t,f);var d=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=r);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r(t,n,e),t.trigger("sync",t,n,e)},I(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0},r);if(i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var a=this,f=r.success;return r.success=function(e){a.attributes=u;var t=a.parse(e,r);r.wait&&(t=n.extend(i||{},t));if(n.isObject(t)&&!a.set(t,r))return!1;f&&f(a,e,r),a.trigger("sync",a,e,r)},I(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)};if(this.isNew())return e.success(),!1;I(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||F();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var m=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1};n.extend(m.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,y))},remove:function(e,t){var r=!n.isArray(e);e=r?[e]:n.clone(e),t||(t={});var i,s,o,u;for(i=0,s=e.length;i<s;i++){u=e[i]=this.get(e[i]);if(!u)continue;delete this._byId[u.id],delete this._byId[u.cid],o=this.indexOf(u),this.models.splice(o,1),this.length--,t.silent||(t.index=o,u.trigger("remove",u,this,t)),this._removeReference(u,t)}return r?e[0]:e},set:function(e,t){t=n.defaults({},t,g),t.parse&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?e?[e]:[]:n.clone(e);var i,s,o,u,a,f,l,c=t.at,h=this.model,p=this.comparator&&c==null&&t.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,m=[],y=[],b={},w=t.add,E=t.merge,S=t.remove,x=!p&&w&&S?[]:!1;for(i=0,s=e.length;i<s;i++){a=e[i]||{},a instanceof d?o=u=a:o=a[h.prototype.idAttribute||"id"];if(f=this.get(o))S&&(b[f.cid]=!0),E&&(a=a===u?u.attributes:a,t.parse&&(a=f.parse(a,t)),f.set(a,t),p&&!l&&f.hasChanged(v)&&(l=!0)),e[i]=f;else if(w){u=e[i]=this._prepareModel(a,t);if(!u)continue;m.push(u),this._addReference(u,t)}u=f||u,x&&(u.isNew()||!b[u.id])&&x.push(u),b[u.id]=!0}if(S){for(i=0,s=this.length;i<s;++i)b[(u=this.models[i]).cid]||y.push(u);y.length&&this.remove(y,t)}if(m.length||x&&x.length){p&&(l=!0),this.length+=m.length;if(c!=null)for(i=0,s=m.length;i<s;i++)this.models.splice(c+i,0,m[i]);else{x&&(this.models.length=0);var T=x||m;for(i=0,s=T.length;i<s;i++)this.models.push(T[i])}}l&&this.sort({silent:!0});if(!t.silent){for(i=0,s=m.length;i<s;i++)(u=m[i]).trigger("add",u,this,t);(l||x&&x.length)&&this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return u.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},I(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(e,n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_addReference:function(e,t){this._byId[e.cid]=e,e.id!=null&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(b,function(e){m.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var w=["groupBy","countBy","sortBy","indexBy"];n.each(w,function(e){m.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var E=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,x)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(S),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}}),t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||F()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1),o.type==="PATCH"&&T&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,a,i),a};var T=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,A=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,P=/msie [\w.]+/,H=/\/$/,B=/#.*$/;M.started=!1,n.extend(M.prototype,f,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(H,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/");if(s&&this._wantsHashChange){var o=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var u=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&u.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!M.started)return!1;if(!t||t===!0)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));e=e.replace(B,"");if(this.fragment===e)return;this.fragment=e,e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new M;var j=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};d.extend=m.extend=C.extend=E.extend=M.extend=j;var F=function(){throw new Error('A "url" property or function must be specified')},I=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t}),define("moment",[],function(){return moment}),define("src/model/Credit",["backbone"],function(e){var t=e.Model.extend({defaults:{type:"",name:"",value:0,startValue:0}});return t}),define("src/model/Reservation",["jquery","underscore","backbone","moment"],function(e,t,n,r){var i=n.Model.extend({defaults:{type:"",title:gettext("Votre réservation"),color:"",resource:null,count:0,startCount:0,number:0,from_date:null,to_date:null,center:Tandoori.reservation.data.centers[0].pk,account:Tandoori.reservation.data.account_id,service_type:null,service:"",unit:"",success:null,errors:null},getFullCalendarEvent:function(){var e=t.pick(this.attributes,"allDay","count","number","title","color","textColor","backgroundColor","borderColor");return t.extend(e,{id:this.id||this.cid,start:r(this.get("from_date")),end:r(this.get("to_date")),resourceId:this.get("resource")?this.get("resource").id:null})},toMinimalJSON:function(){return{service_type:this.get("service_type"),from_date:this.get("from_date"),to_date:this.get("to_date"),center:this.get("center"),account:this.get("account"),service:this.get("service"),unit:this.get("unit")}}});return i.create=function(e,n,s){var o=t.pick(e,"title","color","textColor","backgroundColor","borderColor","allDay","count","number");t.extend(o,{type:n,resource:s,startCount:e.count,from_date:r(e.start),to_date:r(e.end),service_type:s?null:Tandoori.reservation.data.centers[0].desk_service_type,service:s?s.id:null});switch(n){case"desk-pm":case"desk-am":o.unit="hd";break;case"desk-day":o.unit="d";break;case"desk-month":o.unit="m";break;case"meeting_room":o.unit="hh";break;default:}return new i(o)},i}),define("src/collection/Credits",["backbone","../model/Credit"],function(e,t){var n=e.Collection.extend({model:t});return n}),define("src/collection/Reservations",["backbone","../model/Reservation"],function(e,t){var n=e.Collection.extend({model:t,comparator:function(e,t){var n=e.get("resource")&&e.get("resource").title,r=t.get("resource")&&t.get("resource").title;if(n!==r)return n.localeCompare(r);var i=e.get("from_date").toDate().getTime(),s=t.get("from_date").toDate().getTime();return i-s}});return n}),define("src/model/MenuItem",["backbone"],function(e){var t=e.Model.extend({defaults:{text:gettext("Menu item"),rightText:"",label:null,divider:!1,disabled:!1,header:!1}});return t}),define("src/collection/Menu",["backbone","../model/MenuItem"],function(e,t){var n=e.Collection.extend({model:t});return n}),define("src/view/Base",["underscore","backbone"],function(e,t){var n=t.View.extend({tpl:e.template(""),initialize:function(e){n.__super__.initialize.apply(this,arguments),this.options=e,this.model&&(this.renderOnChange||e.renderOnChange)&&this.model.on("change",function(){this.render()},this)},render:function(e){!e&&this.model&&(e=this.model.toJSON()),e=e||this.data||{},e.model=this.model;var t=this.tpl(e);return this.$el.html(t),this.rendered=!0,this}});return n}),define("src/view/List",["jquery","./Base"],function(e,t){var n=t.extend({tagName:"ul",animate:!0,initialize:function(e){n.__super__.initialize.apply(this,arguments),this.collection.on("add",this.addItem,this),this.collection.on("remove",this.removeItem,this),this.collection.on("sort",this.sortItems,this),this.collection.on("reset",this.reset,this);if(!this.getItemView&&!e.getItemView)throw new Error("Missing option: getItemView()")},reset:function(){this.$el.empty(),this.animate=!1,this.render(),this.animate=!0},render:function(){return this.rendered=!0,this.collection.each(this.addItem,this),this},modelFromEl:function(t){if(!e.contains(this.el,t))return;var n=e(t).parents("li").first();if(n.hasClass("js-removing"))return;var r=n.index();return this.collection.at(r)},addItem:function(t){if(this.rendered){var n=(this.getItemView||this.options.getItemView)(t);t.view=n,n.render();var r;this.options.dontWrapInLi?r=n.$el:r=e("<li>").append(n.$el),this.animate?(r.hide().appendTo(this.$el),this.sortItems(),r.slideDown()):(r.appendTo(this.$el),this.sortItems())}},removeItem:function(t,n,r){var i=r.index;delete t.view;var s=this.$el.children("li").eq(i);this.animate?s.addClass("js-removing").slideUp(function(){e(this).remove()}):s.remove()},sortItems:function(){var e=this.$el;this.collection.each(function(t,n){if(t.view){var r=t.view.$el.parent();r.appendTo(e)}})}});return n}),define("src/view/ReservationEvent",["./Base"],function(e){var t=e.extend({className:"reservation-event-preview panel-body",renderOnChange:!0});return t}),define("src/util/overloadTemplate",["underscore"],function(e){return function(t,n){var r=$("#overload_"+t);if(r.length>0){var i=r.text();return e.template(i)}return n}}),define("text",["module"],function(e){"use strict";var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.14",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.lastIndexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}d.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i[0]==="﻿"&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("tpl",["underscore","text"],function(e,t){"use strict";var n={},r={version:"0.1.0",load:function(r,i,s,o){var u=function(t){t=e.template(t),o.isBuild?t=n[r]=t.source:t=(new Function("obj","return "+t.source))(),s(t)};t.load(r,i,u,o)},write:function(e,t,r){n.hasOwnProperty(t)&&r('define("'+e+"!"+t+'", ["underscore"], function(_) { '+"return "+n[t]+";"+"});\n")}};return r}),define("tpl!src/template/roomEvent.ejs",["underscore"],function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="";var successClass="";success!=null&&(successClass=success?"reservation-success":"reservation-error"),__p+='\n<div class="panel-body '+((__t=successClass)==null?"":__t)+'">\n    <button type="button" class="close js-reservation-event-delete" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <h3 class="panel-title">'+((__t=resource&&resource.title)==null?"":__t)+"</h3>\n    ",from_date.isSame(to_date,"day")?__p+="\n        "+((__t=interpolate(gettext("Le %s de %s à %s"),[from_date.format("D MMMM").replace(/ /g,"&nbsp;"),from_date.format("H:mm"),to_date.format("H:mm")]))==null?"":__t)+"\n    ":__p+="\n        "+((__t=interpolate(gettext("Du %s au %s"),[from_date.format("D MMMM, H:mm").replace(/ /g,"&nbsp;"),to_date.format("D MMMM, H:mm").replace(/ /g,"&nbsp;")]))==null?"":__t)+"\n    ",__p+="\n</div>"}return __p}}),define("src/view/RoomReservationEvent",["./ReservationEvent","../util/overloadTemplate","tpl!src/template/roomEvent.ejs"],function(e,t,n){n=t("roomEvent",n);var r=e.extend({tpl:n});return r}),define("tpl!src/template/deskEvent.ejs",["underscore"],function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="";var successClass="";success!=null&&(successClass=success?"reservation-success":"reservation-error"),__p+='\n<div class="panel-body '+((__t=successClass)==null?"":__t)+'">\n    <button type="button" class="close js-reservation-event-delete" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <h3 class="panel-title">'+((__t=gettext("Bureau"))==null?"":__t)+"</h3>\n    ";var body="";switch(type){case"desk-am":body=interpolate(gettext("Le %s - Matinée"),[from_date.format("D MMMM").replace(/ /g,"&nbsp;")]);break;case"desk-pm":body=interpolate(gettext("Le %s - Après-midi"),[from_date.format("D MMMM").replace(/ /g,"&nbsp;")]);break;case"desk-day":body=interpolate(gettext("Le %s - Journée"),[from_date.format("D MMMM").replace(/ /g,"&nbsp;")]);break;case"desk-month":body=interpolate(gettext("Du %s au %s"),[from_date.format("D MMMM").replace(/ /g,"&nbsp;"),moment(to_date).subtract(1,"minute").format("D MMMM").replace(/ /g,"&nbsp;")])}__p+="\n    "+((__t=body)==null?"":__t)+"\n</div>"}return __p}}),define("src/view/DeskReservationEvent",["./ReservationEvent","../util/overloadTemplate","tpl!src/template/deskEvent.ejs"],function(e,t,n){n=t("deskEvent",n);var r=e.extend({tpl:n});return r}),define("tpl!src/template/preview.ejs",["underscore"],function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="",__p+="\n";var offline=Tandoori.reservation.data.offline;__p+='\n\n<span class="js-reservations-placeholder">'+((__t=gettext("Merci de faire votre choix"))==null?"":__t)+'</span>\n<form class="js-reservations-form">\n\n    ',offline||(__p+='\n    <div class="checkbox">\n        <label>\n            <input type="checkbox" class="js-reservations-validate-checkbox">\n            '+((__t=gettext('Acceptation des <a data-toggle="modal" data-target="#security-notice-modal">consignes de sécurité</a>'))==null?"":__t)+"\n        </label>\n    </div>\n    "),__p+="\n\n    ",offline&&(__p+='\n    <div class="reservations-total">\n      <strong>'+((__t=gettext("Total HT : "))==null?"":__t)+'</strong>\n      <span class="js-reservations-total">'+((__t=price)==null?"":__t)+"</span>\n    </div>\n    "),__p+='\n\n    <input\n      type="submit"\n      class="btn btn-success js-reservations-validate-btn"\n      value="'+((__t=offline?gettext("Payer"):gettext("Réserver"))==null?"":__t)+'"\n    />\n</form>\n<a class="btn btn-tandoori-blue js-reservations-buy-btn">'+((__t=gettext("Acheter des crédits"))==null?"":__t)+"</a>"}return __p}}),define("src/view/ReservationPreview",["jquery","underscore","backbone","moment","./Base","./List","./RoomReservationEvent","./DeskReservationEvent","../util/overloadTemplate","tpl!src/template/preview.ejs"],function(e,t,n,r,i,s,o,u,a,f){f=a("preview",f);var l=i.extend({tpl:f,events:{"click  .js-reservation-event-delete":"onDeleteClicked","submit .js-reservations-form":"onSubmit","change .js-reservations-validate-checkbox":"onCheckboxChange","click .js-reservations-buy-btn":"onBuyClicked"},initialize:function(e){l.__super__.initialize.apply(this,arguments),this.model=new n.Model({price:0,checked:!1,loading:!1,hasNegativeCredits:!1}),this.rooms=e.rooms,this.desks=e.desks,this.credits=e.credits,this.roomList=new s({className:"preview-list",collection:this.rooms,getItemView:function(e){return new o({model:e})}}),this.deskList=new s({className:"preview-list",collection:this.desks,getItemView:function(e){return new u({model:e})}}),this.rooms.on("add",this.onReservationsChange,this),this.rooms.on("remove",this.onReservationsChange,this),this.desks.on("add",this.onReservationsChange,this),this.desks.on("remove",this.onReservationsChange,this),this.model.on("change",this.onModelChange,this),this.credits.on("change",this.checkNegativeCredits,this)},render:function(){return l.__super__.render.apply(this,arguments),this.$(".js-reservations-total").autoNumeric("init",{aSep:" ",aDec:",",aSign:" €",pSign:"s",wEmpty:"zero"}),this.roomList.render(),this.deskList.render(),this.$el.prepend(this.roomList.$el),this.$el.prepend(this.deskList.$el),this.onReservationsChange(),this.onModelChange(),this},checkNegativeCredits:function(){var e=!1;this.credits.each(function(t){t.get("value")<0&&(e=!0)}),this.model.set("hasNegativeCredits",e)},setLoading:function(e){this.model.set("loading",e)},batchSave:function(){var n=[].concat(this.desks.models).concat(this.rooms.models),i=n.map(function(e){var t=e.toMinimalJSON();return t.from_date=r(t.from_date).local().format(),t.to_date=r(t.to_date).local().format(),t}),s=this;this.setLoading(!0),e.ajax({method:"POST",url:Tandoori.urls.done,contentType:"application/json",data:JSON.stringify(i)}).then(function(e,r,i){s.setLoading(!1),t.isArray(e)?s.handleErrors(n,e):Tandoori.reservation.data.offline?window.location=Tandoori.urls.signup:console.warn("Didn't receive multiple responses")},function(e,r,i){s.setLoading(!1);var o=e.responseJSON;t.isArray(o)?s.handleErrors(n,o):alert(i)})},handleErrors:function(e,n){var r=[];t.each(n,function(n,i){e[i].set("success",n.success),n.success||(e[i].set("errors",n.errors),t.each(n.errors,function(e){e.client_display_error?r.push(e.error):r.push(gettext("Une erreur technique est survenue."))}))});if(r.length>0){var i=r.join("<br />");i+='<br/><a class="btn btn-primary" href="javascript:location.reload()">'+gettext("Recharger la page")+"</a>",alert_define("danger",i)}else alert_define("info",gettext("Réservations enregistrées.")+'<br/><a class="btn btn-primary" href="'+Tandoori.urls.calendar+'">'+gettext("Aller à l'agenda")+"</a>")},updateTotal:function(){var t=this,n={items:[]};this.desks.each(function(e){n.items.push({quantity:1,unit:e.get("unit"),service_type:e.get("service_type")})}),this.rooms.each(function(e){n.items.push({quantity:1,unit:e.get("unit"),service_type:e.get("service_type")})}),e.ajax({method:"POST",url:Tandoori.urls.price,contentType:"application/json",data:JSON.stringify(n)}).then(function(e,n,r){e.price&&t.model.set("price",e.price)},function(e,t,n){console.warn(n)})},onModelChange:function(){var e=Tandoori.reservation.data.offline||this.model.get("checked")&&!this.model.get("hasNegativeCredits");this.$(".js-reservations-validate-btn").prop("disabled",!e);var t=this.model.get("price");this.$(".js-reservations-total").autoNumeric("set",t);var n=!Tandoori.reservation.data.offline&&this.model.get("hasNegativeCredits");this.$(".js-reservations-buy-btn").toggle(n);var r=this.model.get("loading");this.$el.toggleClass("loading",r)},onReservationsChange:function(){this.rooms.length+this.desks.length>0?(this.$(".js-reservations-placeholder").hide(),this.$(".js-reservations-form").show()):(this.$(".js-reservations-placeholder").show(),this.$(".js-reservations-form").hide()),Tandoori.reservation.data.offline&&this.updateTotal()},onSubmit:function(e){e.preventDefault(),this.trigger("save"),this.batchSave()},onDeleteClicked:function(e){var t=this.deskList.modelFromEl(e.currentTarget);t||(t=this.roomList.modelFromEl(e.currentTarget)),t.destroy()},onCheckboxChange:function(){var e=this.$(".js-reservations-validate-checkbox").is(":checked");this.model.set("checked",e)},onBuyClicked:function(){this.trigger("buy-clicked")}});return l}),define("tpl!src/template/availableCredits.ejs",["underscore"],function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<p>"+((__t=name)==null?"":__t)+" : "+((__t=value/2)==null?"":__t)+"</p>";return __p}}),define("src/view/Credit",["./Base","../util/overloadTemplate","tpl!src/template/availableCredits.ejs"],function(e,t,n){n=t("availableCredits",n);var r=e.extend({tpl:n,renderOnChange:!0});return r}),define("src/view/Credits",["./List","./Credit"],function(e,t){var n=e.extend({className:"reservation-available-credits",getItemView:function(e){return new t({model:e})}});return n}),define("tpl!src/template/menuItem.ejs",["underscore"],function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",header?__p+="\n    "+((__t=text)==null?"":__t)+"\n":(__p+='\n    <a href="#" tabindex="-1" role="menuitem">\n        '+((__t=text)==null?"":__t)+"\n        ",label&&(__p+='\n            <span class="label label-'+((__t=label.type||"default")==null?"":__t)+'">\n                '+((__t=label.text)==null?"":__t)+"\n            </span>\n        "),__p+="\n        ",rightText&&(__p+='\n            <span class="pull-right right-text">\n                '+((__t=rightText)==null?"":__t)+"\n            </span>\n        "),__p+="\n    </a>\n"),__p+="";return __p}}),define("src/view/MenuItem",["./Base","../util/overloadTemplate","tpl!src/template/menuItem.ejs"],function(e,t,n){n=t("menuItem",n);var r=e.extend({tagName:"li",tpl:n,renderOnChange:!0,attributes:{tabindex:"-1",href:"#"},getOrTpl:function(e){var t=this.model.get(e);return typeof t=="function"?t(this.model.toJSON()):t},render:function(){var e=this.model.toJSON();e.text=this.getOrTpl("text"),e.rightText=this.getOrTpl("rightText"),r.__super__.render.call(this,e),this.$el.removeClass("divider"),this.$el.removeClass("disabled");if(this.model.get("divider"))return this.$el.addClass("divider"),this.$el.empty(),this;this.model.get("disabled")&&this.$el.addClass("disabled"),this.model.get("header")&&this.$el.addClass("dropdown-header")}});return r}),define("src/view/Menu",["jquery","underscore","./Base","./List","./MenuItem"],function(e,t,n,r,i){var s=n.extend({className:"dropdown clearfix reservation-menu",attributes:{style:"position:absolute; display:none; z-index: 500;"},events:{"click a":"onItemClick"},initialize:function(e){s.__super__.initialize.apply(this,arguments),this.menuList=new r({dontWrapInLi:!0,className:"dropdown-menu",collection:e.items,attributes:{role:"menu",style:"display:block;position:static;margin-bottom:5px;"},getItemView:function(e){return new i({model:e,attributes:{role:"presentation"}})}}),this.onDocumentClick=t.bind(this.onDocumentClick,this)},render:function(){this.menuList.render(),this.$el.append(this.menuList.$el),this.$el.on("click mousedown mouseup",function(e){e.preventDefault(),e.stopPropagation()})},showAt:function(t,n,r){typeof r=="function"&&this.setCallback(r);var i=this.onDocumentClick;e(document).off("click",i),setTimeout(function(){e(document).one("click",i)},0),this.$el.css({display:"block",left:t,top:n})},hide:function(){this.$el.hide()},setCallback:function(e){this.callback=e},onDocumentClick:function(e){this.hide()},onItemClick:function(e){e.preventDefault(),e.stopPropagation(),this.hide();var t=this.menuList.modelFromEl(e.currentTarget);typeof this.callback=="function"&&this.callback(t)}});return s}),define("src/util/momentTime",["moment"],function(e){function t(t,n){return e(t.format("YYYY-MM-DD")+"T"+n)}return t}),define("src/util/batchCalendar",[],function(){function e(e,t){var n=e.parent();e.detach(),t(),e.appendTo(n),e.fullCalendar("rerenderEvents")}return e}),define("src/App",["underscore","jquery","backbone","moment","./model/Credit","./model/Reservation","./collection/Credits","./collection/Reservations","./collection/Menu","./view/ReservationPreview","./view/Credits","./view/Menu","./util/momentTime","./util/batchCalendar"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){function E(t,n){var r=e.some(n,function(e){return t.resourceId!=e.resourceId?!1:t.start<e.end&&t.end>e.start});return Boolean(r)}function S(t){var n=[],i=r(t.start),s=h(t.start,w);while(!i.isSame(t.end,"day"))n.push(e.extend({},t,{start:i,end:s})),i=h(i,b).add(1,"day"),s=r(s).add(1,"day");return n.push(e.extend({},t,{start:i,end:t.end})),n}function x(t){if(t.type==="desk-month")return[t];var n=[],i=r(t.start),s=h(t.start,t.end.format("HH:mm"));while(!i.isSame(t.end,"day"))n.push(e.extend({},t,{start:i,end:s})),i=r(i).add(1,"day"),s=r(s).add(1,"day");return n.push(e.extend({},t,{start:i,end:t.end})),n}function T(t,n,i){function c(t){return e.find(i,function(e){return r(e.start).isSame(t,"day")})}var s=[],o=Tandoori.reservation.data.centers[0].half_day_periods,u=Tandoori.reservation.data.centers[0],a=r().utc().startOf("day");t<a&&(t=a);var f=[],l=r(t);while(l<n)f.push(r(l)),l.add(1,"day");for(var p=0;p<f.length;p++){var d=f[p],v=c(d);v?s.push({allDay:!0,count:v.am_count,number:v.number||u.nb_desks||0,service_type:v.service_type,start:h(d,o[0].start_time),end:h(d,o[0].end_time)},{allDay:!0,count:v.pm_count,number:v.number||u.nb_desks||0,service_type:v.service_type,start:h(d,o[1].start_time),end:h(d,o[1].end_time)}):s.push({allDay:!0,count:0,number:u.nb_desks||0,service_type:u.desk_service_type,start:h(d,o[0].start_time),end:h(d,o[0].end_time)},{allDay:!0,count:0,number:u.nb_desks||0,service_type:u.desk_service_type,start:h(d,o[1].start_time),end:h(d,o[1].end_time)})}return s}function N(){this.views={},this.createDataStructures(),this.createViews()}var d=e.map(Tandoori.reservation.data.centers,function(t){return{id:t.pk,title:t.name,children:e.map(t.rooms,function(e){return{id:e.pk,title:e.name}})}}),v=[],m=[];e.each(Tandoori.reservation.data.centers,function(t){e.each(t.opening_hours,function(e){v.push(e.opening_time),m.push(e.closing_time)})});var g,y;v=e.map(v,function(e){return h(r(),e)}),v.sort(),m=e.map(m,function(e){return h(r(),e)}),m.sort(),g=v[0],y=m[m.length-1];var b=g.format("HH:mm"),w=y.format("HH:mm");return e.extend(N.prototype,n.Events,{createDataStructures:function(){var e=this;this.existingRoomReservations=new u,this.existingDeskReservations=new u,this.deskAvailabilityFakeReservations=new u,this.roomReservations=new u,this.deskReservations=new u,this.meetingRoomCredits=new i,this.desktopCredits=new i,this.credits=new o([this.meetingRoomCredits,this.desktopCredits]);var t=Tandoori.reservation.data.credits.desk||0,n=Tandoori.reservation.data.credits.meeting_room||0;this.meetingRoomCredits.set({type:"meeting_room",name:gettext("Salle de réunion"),startValue:n,value:n}),this.desktopCredits.set({type:"desk",name:gettext("Bureau"),startValue:t,value:t}),this.roomReservations.on("add remove",function(){var t=e.meetingRoomCredits.get("startValue"),n=0;e.roomReservations.each(function(e){n+=e.get("to_date").diff(e.get("from_date"),"minutes")});var r=n/30;e.meetingRoomCredits.set("value",t-r)}),this.deskReservations.on("add remove",function(){var t=e.desktopCredits.get("startValue"),n=0;e.deskReservations.each(function(e){switch(e.get("type")){case"desk-am":case"desk-pm":n+=1;break;case"desk-day":n+=2;break;case"desk-month":n+=60;break;default:}}),e.desktopCredits.set("value",t-n)})},createViews:function(){this.views.preview=this.createPreview(),this.views.availableCredits=this.createCreditsView(),this.views.calendarMenu=this.createMenuView()},createPreview:function(){var e=this,n=new f({rooms:this.roomReservations,desks:this.deskReservations,credits:this.credits});return n.on("buy-clicked",function(){var n={},r=Tandoori.reservation.data.centers[0];e.meetingRoomCredits.get("value")<0&&(n[r.room_base_product]=Math.abs(e.meetingRoomCredits.get("value"))),e.desktopCredits.get("value")<0&&(n[r.desk_base_product]=Math.abs(e.desktopCredits.get("value")));var i=Tandoori.urls.purchase+"?"+t.param({reset:!0,prefill:JSON.stringify(n)});window.location=i}),n.on("save",function(){t("#reservation-container").addClass("locked")}),n},createCreditsView:function(){return new l({collection:this.credits})},createMenuView:function(){return new c({items:new a([{header:!0,text:gettext("Durée de la réservation")},{id:"am",text:gettext("Matinée"),rightText:e.template("<%= event && event.start.format('HH:mm') %> - <%= event && event.end.format('HH:mm') %>"),event:null},{id:"pm",text:gettext("Après-midi"),rightText:e.template("<%= event && event.start.format('HH:mm') %> - <%= event && event.end.format('HH:mm') %>"),event:null},{divider:!0},{id:"day",text:gettext("Toute la journée"),rightText:e.template("<%= event && event.start.format('HH:mm') %> - <%= event && event.end.format('HH:mm') %>"),event:null},{divider:!0},{id:"month",text:e.template("<%= interpolate(gettext(\"Un mois à partir du <strong>%s</strong>\"), [event && event.start.format('D MMMM').replace(/ /g, '&nbsp;')]) %>"),event:null}])})},createCalendars:function(){var n=this,i={};i.meeting_room={timezone:"local",minTime:b,maxTime:w,height:"auto",dow:[1,2,3,4,5],header:{left:"today",center:"title",right:"prev,next"},defaultView:"timeline3Days",views:{timeline3Days:{type:"timeline",duration:{days:3},slotDuration:{minutes:30}}},resourceAreaWidth:"25%",resourceLabelText:gettext("Salles de réunions"),resources:d.length===1?d[0].children:d,selectable:!0,selectHelper:!0,select:function(t,r,i,o,u){var a=e.chain(d).pluck("children").flatten().findWhere({id:o}).value();if(a){var f={start:t,end:r,resourceId:o,title:""},l=u.events;if(!E(f,l)){var c=S(f);e.each(c,function(e){n.roomReservations.add(s.create(e,"meeting_room",a))})}}n.$roomsCalendar.fullCalendar("unselect")},events:function(i,o){function f(e){return e.service&&(e.resource={id:e.service.id}),e.title="",e.color="#ccc",e.start=r(e.start).stripZone(),e.end=r(e.end).stripZone(),e}var u=Tandoori.urls.list_reservations.replace(0,Tandoori.reservation.data.centers[0].pk),a={start:r(i).toISOString(),end:r(o).toISOString(),service_type_id:Tandoori.reservation.data.centers[0].room_service_type};t.ajax({url:u,method:"GET",data:t.param(a||{}),success:function(t){t=e.map(t,f),n.existingRoomReservations.reset(),p(n.$roomsCalendar,function(){e.each(t,function(e){n.existingRoomReservations.add(s.create(e,"meeting_room",e.resource))})})}})}},i.desk={height:"auto",header:{left:"today",center:"title",right:"prev,next"},defaultView:"month",views:{month:{displayEventTime:!0,displayEventEnd:!0,fixedWeekCount:!1}},hiddenDays:[6,0],selectable:!0,selectHelper:!0,selectOverlap:!0,eventClick:function(e,t,n){var s=h(e.start,"00:00"),o=r(s).add(1,"day");i.desk.select.call(n,s,o,t,n)},select:function(t,i,o,u){var a=r().utc().startOf("day");if(t<a){n.$desksCalendar.fullCalendar("unselect");return}var f=Tandoori.reservation.data.centers[0].half_day_periods,l=h(t,f[0].start_time),c=h(t,f[0].end_time),p=h(r(i).subtract(1,"minute"),f[1].start_time),d=h(r(i).subtract(1,"minute"),f[1].end_time),v=!t.isSame(r(i).subtract(1,"minute"),"day"),m={title:gettext("Votre réservation")+"\n",start:l,end:d},g=n.views.calendarMenu.options.items;g.get("am").set("event",e.extend({},m,{end:c})),g.get("pm").set("event",e.extend({},m,{start:p})),g.get("day").set("event",m),g.get("month").set({event:m,disabled:v}),n.views.calendarMenu.showAt(o.pageX,o.pageY,function(t){n.$desksCalendar.fullCalendar("unselect");var r=t.get("id");switch(r){case"am":m.end.hours(c.hours()),m.title+=gettext("Matinée");break;case"pm":m.start.hours(p.hours()),m.title+=gettext("Après-midi");break;case"day":m.title+=gettext("Journée");break;case"month":m.end.add(30,"days"),m.title+=gettext("Mois");break;default:return}m.type="desk-"+r;var i=x(m),o=n.$desksCalendar.fullCalendar("clientEvents");e.each(i,function(e){n.eventAllowed(e,o)&&n.deskReservations.add(s.create(e,"desk-"+r))})})},events:function(i,o){var u=Tandoori.urls.list_aggregated_reservations.replace(0,Tandoori.reservation.data.centers[0].pk),a=Tandoori.urls.list_own_reservations,f={start:r(i).toISOString(),end:r(o).toISOString(),service_type:Tandoori.reservation.data.centers[0].desk_service_type};Tandoori.reservation.data.offline||t.ajax({url:a,method:"GET",data:t.param(f),success:function(t){n.existingDeskReservations.reset(),p(n.$desksCalendar,function(){e.each(t,function(e){n.existingDeskReservations.add(s.create(e,"desk"))})})}});var l=r().utc().startOf("day");l>i&&(f.start=l.toISOString()),t.ajax({url:u,method:"GET",data:t.param(f),success:function(t){t=T(i,o,t),t=e.map(t,function(t){return e.extend(t,{textColor:"#333",borderColor:"#AAA",backgroundColor:"#CCC"}),t}),n.deskAvailabilityFakeReservations.reset(),p(n.$desksCalendar,function(){e.each(t,function(e){n.deskAvailabilityFakeReservations.add(s.create(e,"desk"))}),n.updateAvailability()})}})}},this.$desksCalendar=t("#reservation_desks_calendar"),this.$roomsCalendar=t("#reservation_rooms_calendar"),this.$desksCalendar.fullCalendar(i.desk),this.$roomsCalendar.fullCalendar(i.meeting_room),this.$roomsCalendar.fullCalendar("getView").reportSelection=function(e,t){this.isSelected=!0,this.trigger("select",null,e.start,e.end,t,e.resourceId)}},setupCalendars:function(){var t=this;this.roomReservations.on("add",function(e){var n=e.getFullCalendarEvent();n.start.stripZone(),n.end.stripZone(),t.$roomsCalendar.fullCalendar("renderEvent",n,!0)}),this.roomReservations.on("remove",function(e){t.$roomsCalendar.fullCalendar("removeEvents",[e.id||e.cid])}),this.deskReservations.on("add",function(e){var n=e.getFullCalendarEvent();t.$desksCalendar.fullCalendar("renderEvent",n,!0),t.updateAvailability()}),this.deskReservations.on("remove",function(e){t.$desksCalendar.fullCalendar("removeEvents",[e.id||e.cid]),t.updateAvailability(e)}),this.existingRoomReservations.on("add",function(e){var n=e.getFullCalendarEvent();n.start.stripZone(),n.end.stripZone(),t.$roomsCalendar.fullCalendar("renderEvent",n)}),this.existingDeskReservations.on("add",function(e){var n=e.getFullCalendarEvent();t.$desksCalendar.fullCalendar("renderEvent",n)});var n=e.template("<%= start.hours() < 12 ? 'AM' : 'PM' %>: <%= number - count %> <%= (number - count) === 1 ? gettext('bureau libre') : gettext('bureaux libres') %>");this.deskAvailabilityFakeReservations.on("add",function(e){var r=e.getFullCalendarEvent();r.title=n(r),t.$desksCalendar.fullCalendar("renderEvent",r)}),this.deskAvailabilityFakeReservations.on("change",function(r){var i=t.$desksCalendar.fullCalendar("clientEvents"),s=e.findWhere(i,{id:r.cid});s&&(e.extend(s,r.getFullCalendarEvent()),s.title=n(s),t.$desksCalendar.fullCalendar("updateEvent",s))})},render:function(){var e=this;this.views.preview.render(),this.views.preview.$el.appendTo("#reservation_preview"),this.views.availableCredits.render(),this.views.availableCredits.$el.appendTo("#available_credits"),this.views.calendarMenu.render(),this.views.calendarMenu.$el.appendTo(document.body),this.createCalendars(),this.setupCalendars(),t(".booking-nav a").click(function(n){n.preventDefault(),t(this).tab("show"),(this.hash==="#desk"?e.$desksCalendar:e.$roomsCalendar).fullCalendar("rerenderEvents")}),this.$roomsCalendar.parent().removeClass("active")},updateAvailability:function(t){var n=this;p(this.$desksCalendar,function(){var r;t&&(r=n.getAvailabilityReservationsFromReservation(t),e.each(r,function(e){e.set("count",e.get("startCount"))})),n.deskReservations.each(function(t){r=n.getAvailabilityReservationsFromReservation(t),e.each(r,function(e){e.set("count",e.get("startCount")+1)})})})},getAvailabityReservations:function(e,t,n){var r;if(e==="desk-am"||e==="desk-pm")r=function(e){return e.get("from_date").isSame(t)};return e==="desk-day"&&(r=function(e){return e.get("from_date").isSame(t,"day")}),e==="desk-month"&&(r=function(e){var r=e.get("from_date");return t<=r&&r<=n}),this.deskAvailabilityFakeReservations.filter(r)},getAvailabilityReservationsFromReservation:function(e){return this.getAvailabityReservations(e.get("type"),e.get("from_date"),e.get("to_date"))},eventAllowed:function(t,n){var r=E(t,n);if(r)return!1;var i=this.getAvailabityReservations(t.type,t.start,t.end),s=e.every(i,function(e){var t=e.get("number")-e.get("count");return t>0});return s}}),N}),$(function(){require(["src/App"],function(e){var t=new e;t.render(),window.app=t})}),define("src/main",function(){})})();